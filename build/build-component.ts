import fs from "fs";
import path from "path";
import prettier from "prettier";

const svgSourcePath = path.resolve(__dirname, "../source");

const allIconMap: Record<string, string> = {};

const compile = (type: "react") => {
  const iconsDir = path.resolve(__dirname, `../packages/${type}/src/icons`);
  if (!fs.existsSync(iconsDir)) {
    fs.mkdirSync(iconsDir);
  }

  const exportCodeIntoMapFile = () => {
    const fileNames = fs.readdirSync(iconsDir);
    let fileContent = `
      /**
       * @file Export All Icons
       * @author Auto Generated by QnetIcons
       */
      `;
    fileNames.forEach((fileName) => {
      const name = path.basename(fileName, path.extname(fileName));
      fileContent += `export {default as ${name}} from './icons/${name}';\n`;
    });
    fs.writeFileSync(
      path.resolve(iconsDir, "../index.ts"),
      prettier.format(fileContent, {
        parser: "babel",
        tabWidth: 2
      }),
      { encoding: "utf8" }
    );
  };

  exportCodeIntoMapFile();
};

compile("react");
